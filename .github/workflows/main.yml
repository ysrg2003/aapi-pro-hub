# AAPI Pro Hub - GitHub Actions Workflows

## main.yml - Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ

```yaml
name: AAPI Pro Main Pipeline

on:
  workflow_dispatch:
    inputs:
      prompt:
        description: 'Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…'
        required: true
        type: string
      request_id:
        description: 'Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙØ±ÙŠØ¯'
        required: true
        type: string
      spec:
        description: 'Ù…ÙˆØ§ØµÙØ§Øª SPEC (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)'
        required: false
        type: string
      iteration:
        description: 'Ø±Ù‚Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±'
        required: false
        type: string
        default: '1'
      target_repo:
        description: 'Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù'
        required: false
        type: string

env:
  PYTHON_VERSION: '3.11'
  NODE_VERSION: '20'

jobs:
  # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ (AI-1)
  analyze:
    name: ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ (AI-1)
    runs-on: ubuntu-latest
    outputs:
      spec: ${{ steps.analyze.outputs.spec }}
    steps:
      - name: Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        uses: actions/checkout@v4

      - name: Ø¥Ø¹Ø¯Ø§Ø¯ Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'

      - name: ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          pip install openai google-generativeai pyyaml

      - name: ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
        id: analyze
        env:
          PROMPT: ${{ github.event.inputs.prompt }}
          REQUEST_ID: ${{ github.event.inputs.request_id }}
        run: |
          python scripts/analyzer.py \
            --prompt "$PROMPT" \
            --request-id "$REQUEST_ID" \
            --output spec.json
        shell: bash

      - name: Ø±ÙØ¹ SPEC
        uses: actions/upload-artifact@v4
        with:
          name: spec-${{ github.event.inputs.request_id }}
          path: spec.json
          retention-days: 7

  # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ (AI-2)
  generate-code:
    name: ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ (AI-2)
    needs: analyze
    runs-on: ubuntu-latest
    steps:
      - name: Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        uses: actions/checkout@v4

      - name: ØªØ­Ù…ÙŠÙ„ SPEC
        uses: actions/download-artifact@v4
        with:
          name: spec-${{ github.event.inputs.request_id }}
          path: .

      - name: Ø¥Ø¹Ø¯Ø§Ø¯ Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'

      - name: ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          pip install openai pyyaml

      - name: ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          PROMPT: ${{ github.event.inputs.prompt }}
          REQUEST_ID: ${{ github.event.inputs.request_id }}
          TARGET_REPO: ${{ github.event.inputs.target_repo || github.repository }}
        run: |
          python scripts/code_generator.py \
            --spec spec.json \
            --output generated_code \
            --target-repo "$TARGET_REPO"

      - name: Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª
        run: |
          tar -I zstd -cvf code_output.tar.zst generated_code/

      - name: Ø±ÙØ¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙÙ†Ø´Ø£
        uses: actions/upload-artifact@v4
        with:
          name: code-${{ github.event.inputs.request_id }}
          path: code_output.tar.zst
          retention-days: 7

  # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
  build-and-test:
    name: Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø®ØªØ¨Ø§Ø±
    needs: generate-code
    runs-on: ubuntu-latest
    steps:
      - name: Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù
        uses: actions/checkout@v4
        with:
          repository: ${{ github.event.inputs.target_repo || 'owner/repo' }}
          path: target_repo
          token: ${{ secrets.GH_TOKEN }}

      - name: ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙÙ†Ø´Ø£
        uses: actions/download-artifact@v4
        with:
          name: code-${{ github.event.inputs.request_id }}
          path: .

      - name: ÙÙƒ Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª
        run: |
          tar -I zstd -xvf code_output.tar.zst -C target_repo/

      - name: Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        if: hashFiles('target_repo/package.json')
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Ø¥Ø¹Ø¯Ø§Ø¯ Python
        if: hashFiles('target_repo/requirements.txt')
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'

      - name: ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: |
          cd target_repo
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          if [ -f package.json ]; then npm install; fi

      - name: Ø§Ù„Ø¨Ù†Ø§Ø¡
        run: |
          cd target_repo
          if [ -f Makefile ]; then make build; fi
          if [ -f package.json ]; then npm run build; fi

      - name: ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        run: |
          cd target_repo
          if [ -f pytest.ini ] || [ -f setup.py ]; then pytest -v; fi
          if [ -f package.json ]; then npm test; fi

      - name: ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        run: |
          cd target_repo
          if [ -f requirements.txt ]; then pip install pylint flake8; pylint . || true; fi

      - name: Ø¬Ù…Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        run: |
          echo "BUILD_EXIT_CODE=$?" >> $GITHUB_ENV
          echo "Logs collected"

      - name: Ø±ÙØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        uses: actions/upload-artifact@v4
        with:
          name: logs-${{ github.event.inputs.request_id }}
          path: |
            target_repo/*.log
            target_repo/test-results/
          retention-days: 7

  # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
  evaluate:
    name: ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    needs: build-and-test
    runs-on: ubuntu-latest
    outputs:
      passed: ${{ steps.evaluate.outputs.passed }}
      failures: ${{ steps.evaluate.outputs.failures }}
    steps:
      - name: Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        uses: actions/checkout@v4

      - name: ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        uses: actions/download-artifact@v4
        with:
          path: results
          pattern: '*-{{ github.event.inputs.request_id }}'
          merge-multiple: true

      - name: ØªØ­Ù…ÙŠÙ„ SPEC
        uses: actions/download-artifact@v4
        with:
          name: spec-${{ github.event.inputs.request_id }}
          path: .

      - name: Ø¥Ø¹Ø¯Ø§Ø¯ Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        run: pip install pyyaml

      - name: ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ØªÙŠØ¬Ø©
        id: evaluate
        env:
          ITERATION: ${{ github.event.inputs.iteration || '1' }}
        run: |
          python scripts/evaluator.py \
            --spec spec.json \
            --logs results/logs \
            --iteration "$ITERATION" \
            --output evaluation.json

      - name: Ø±ÙØ¹ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
        uses: actions/upload-artifact@v4
        with:
          name: evaluation-${{ github.event.inputs.request_id }}
          path: evaluation.json
          retention-days: 7

  # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Ø§Ù„ØªÙƒØ±Ø§Ø± Ø£Ùˆ Ø§Ù„Ù†Ø¬Ø§Ø­
  decision:
    name: Ù‚Ø±Ø§Ø± Ø§Ù„ØªÙƒØ±Ø§Ø±
    needs: evaluate
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
        uses: actions/download-artifact@v4
        with:
          name: evaluation-${{ github.event.inputs.request_id }}
          path: .

      - name: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©
        id: decision
        run: |
          PASSED=$(cat evaluation.json | jq -r '.passed')
          ITERATION=${{ github.event.inputs.iteration || '1' }}
          
          if [ "$PASSED" = "true" ]; then
            echo "âœ… Ù†Ø¬Ø­ Ø§Ù„Ø·Ù„Ø¨!"
            echo "passed=true" >> $GITHUB_ENV
          elif [ "$ITERATION" -lt 5 ]; then
            echo "ðŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± (Ù…Ø­Ø§ÙˆÙ„Ø© $((ITERATION+1)))"
            echo "retry=true" >> $GITHUB_ENV
          else
            echo "âŒ ÙØ´Ù„ Ø¨Ø¹Ø¯ 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª"
            echo "failed=true" >> $GITHUB_ENV
          fi

      - name: Ø¥Ù†Ø´Ø§Ø¡ Release Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
        if: env.passed == 'true'
        run: |
          gh release create v${{ github.run_id }} \
            --title "Release ${{ github.run_id }}" \
            --generate-notes

      - name: ØªÙƒØ±Ø§Ø± Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„
        if: env.retry == 'true'
        run: |
          NEXT_ITERATION=$((${{ github.event.inputs.iteration || 1 }} + 1))
          gh workflow run main.yml \
            -f prompt="${{ github.event.inputs.prompt }}" \
            -f request_id="${{ github.event.inputs.request_id }}" \
            -f iteration="$NEXT_ITERATION"
